<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>DonJu Gourmet ‚Äî Pedidos</title>
  <meta name="description" content="DonJu Gourmet: postres artesanales de 180 ml por encargo. Cierre 18:00, entrega al d√≠a siguiente. La Florida, Macul, Pe√±alol√©n, Puente Alto, La Granja." />
  <meta name="theme-color" content="#fbf7f2" />

  <!-- Open Graph -->
  <meta property="og:title" content="DonJu Gourmet ‚Äî Pedidos por WhatsApp" />
  <meta property="og:description" content="Postres 180 ml ¬∑ Cierre 18:00 ¬∑ Entrega al d√≠a siguiente ¬∑ La Florida y alrededores" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://juliohernandezm40-creator.github.io/donju-gourmet/" />
  <meta property="og:image" content="https://juliohernandezm40-creator.github.io/donju-gourmet/logo.jpg" />
  <meta property="og:locale" content="es_CL" />

  <link rel="icon" href="logo.jpg" type="image/jpeg">
  <link rel="apple-touch-icon" href="logo.jpg">

  <style>
    :root{
      --bg:#fbf7f2;
      --stroke:rgba(40,20,10,.10);
      --stroke2:rgba(40,20,10,.16);
      --text:#1b1411;
      --muted:rgba(27,20,17,.68);
      --accent:#7a4d2a;
      --shadow: 0 18px 45px rgba(30,15,10,.18);
      --r2:22px;
      --max:1020px;
      --gold1: rgba(215,180,106,.55);
      --gold2: rgba(215,180,106,.18);
      --focus: rgba(122,77,42,.35);
      --wa: rgba(37, 211, 102, .22);
      --waStroke: rgba(37, 211, 102, .45);
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}

    :focus-visible{
      outline: 2px solid var(--focus);
      outline-offset: 2px;
      border-radius: 6px;
    }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 800px at 10% 0%, rgba(42,166,161,.12) 0%, transparent 60%),
        radial-gradient(1000px 700px at 90% 10%, rgba(122,77,42,.10) 0%, transparent 62%),
        radial-gradient(900px 600px at 40% 110%, rgba(255,120,160,.10) 0%, transparent 55%),
        var(--bg);
      color:var(--text);
      line-height:1.5;
    }

    a{color:inherit}
    a:hover{ text-decoration: underline; }
    a.btn:hover{ text-decoration: none; }

    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:120px 22px 22px;
    }

    .topbar{
      position:fixed;
      top:12px;
      left:50%;
      transform:translateX(-50%);
      width:min(var(--max), calc(100% - 44px));
      z-index:999;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 14px;
      background: rgba(255,255,255,.85);
      border:1px solid var(--stroke);
      border-radius:var(--r2);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      gap:12px;
    }

    .brand{
      display:flex; align-items:center; gap:12px;
      min-width:0;
      flex:1;
    }

    .logo{
      width:76px; height:76px; border-radius:20px; overflow:hidden; flex:0 0 auto;
      background:rgba(255,255,255,.55);
      border:1px solid var(--gold1);
      box-shadow: 0 14px 30px rgba(30,15,10,.14), 0 0 0 6px var(--gold2);
    }
    .logo img{width:100%; height:100%; object-fit:cover; display:block;}

    .brandText{min-width:0; flex:1;}
    .brandText h1{margin:0; font-size:18px; letter-spacing:.3px; font-weight:700;}
    .brandText small{
      display:block;
      color:var(--muted);
      margin-top:3px;
      line-height:1.2;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      font-size:13px;
    }

    .actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; flex:0 0 auto}

    .btn{
      border:1px solid var(--stroke2);
      background:linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.55));
      color:var(--text);
      padding:10px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
      text-decoration:none;
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .06s ease, box-shadow .2s ease, background .2s;
      user-select:none;
      box-shadow: 0 10px 24px rgba(30,15,10,.08);
      font-size:14px;
      min-height:44px;
      line-height:1;
    }
    .btn:hover{ background: rgba(255,255,255,.95); }
    .btn:active{transform:scale(.98)}
    .btn.primary{
      border-color: var(--gold1);
      background:linear-gradient(180deg, rgba(215,180,106,.35), rgba(215,180,106,.15));
      box-shadow: 0 12px 26px rgba(122,77,42,.18);
    }
    .btn.primary:hover{
      background:linear-gradient(180deg, rgba(215,180,106,.45), rgba(215,180,106,.20));
    }
    .btn.ghost{
      background:transparent;
      border-color: var(--stroke);
      box-shadow:none;
    }

    /* Bot√≥n WhatsApp con √≠cono */
    .btn.whatsapp{
      border-color: var(--waStroke);
      background: linear-gradient(180deg, rgba(37,211,102,.18), rgba(37,211,102,.10));
    }
    .btn.whatsapp:hover{
      background: linear-gradient(180deg, rgba(37,211,102,.26), rgba(37,211,102,.14));
    }
    .waIcon{
      width:18px;
      height:18px;
      display:block;
      flex:0 0 auto;
    }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.70);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
      box-shadow: 0 10px 22px rgba(30,15,10,.06);
      font-weight:500;
    }

    .hero{
      padding:18px;
      border-radius:var(--r2);
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.82), rgba(255,255,255,.68));
      box-shadow: var(--shadow);
      display:grid;
      gap:14px;
    }
    .hero h2{margin:0; font-size:22px; letter-spacing:.2px; font-weight:800;}
    .hero p{margin:0; color:var(--muted); line-height:1.5}
    .heroRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}

    .heroCarousel{
      display:grid;
      grid-template-columns: 44px 1fr 44px;
      gap:10px;
      align-items:center;
      margin-top:10px;
    }
    .hcBtn{
      height:44px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.80);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
      transition: background .2s, transform .06s ease;
      min-width:44px;
    }
    .hcBtn:hover{ background: rgba(255,255,255,.95); }
    .hcBtn:active{ transform: scale(.98); }

    .hcFrame{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.70);
      height:220px;
    }
    @media(min-width:740px){ .hcFrame{height:280px} }
    .hcFrame img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .hcCaption{
      position:absolute;
      left:10px; bottom:10px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.50);
      background:rgba(255,255,255,.90);
      color:var(--text);
      font-weight:800;
      font-size:12px;
      backdrop-filter: blur(4px);
    }

    .grid{display:grid; gap:16px; margin-top:16px}
    @media(min-width:980px){ .grid.cols2{grid-template-columns: 1.1fr .9fr} }

    .card{
      border-radius:var(--r2);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.80);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      padding:18px;
    }
    .card h3{margin:0 0 10px 0; font-size:17px; font-weight:900;}
    .muted{color:var(--muted)}
    .hr{height:1px; background:rgba(40,20,10,.10); margin:16px 0; border:none;}

    .menuList{display:grid; gap:12px}
    .item{
      display:grid;
      grid-template-columns: 72px 1fr auto;
      gap:12px;
      align-items:center;
      padding:12px;
      border-radius:18px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.70);
      box-shadow: 0 10px 22px rgba(30,15,10,.06);
      transition: transform .15s ease, box-shadow .2s;
    }
    .item:hover{
      transform: translateY(-2px);
      box-shadow: 0 14px 28px rgba(30,15,10,.10);
    }
    .thumb{
      width:72px; height:72px; border-radius:18px; overflow:hidden;
      border:1px solid rgba(40,20,10,.10);
      background:rgba(255,255,255,.70);
      flex-shrink:0;
    }
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}
    .itemTitle{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
    .itemTitle strong{font-size:14px; font-weight:900;}
    .desc{color:var(--muted); font-size:12px; line-height:1.4; margin-top:4px}
    .priceTag{font-weight:950; color:var(--accent); font-size:14px; white-space:nowrap}

    .qty input{
      width:76px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(40,20,10,.18);
      background:rgba(255,255,255,.85);
      color:var(--text);
      outline:none;
      font-weight:900;
      text-align:center;
      font-size:15px;
      -moz-appearance: textfield;
      min-height:44px;
    }
    .qty input::-webkit-outer-spin-button,
    .qty input::-webkit-inner-spin-button { -webkit-appearance: none; margin:0; }

    label{display:block; font-size:13px; color:var(--muted); margin:12px 0 6px; font-weight:700;}
    input[type="text"], input[type="tel"], select, textarea{
      width:100%;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(40,20,10,.20);
      background:rgba(255,255,255,.85);
      color:var(--text);
      outline:none;
      font-size:15px;
      transition: border-color .2s, box-shadow .2s;
      min-height:44px;
    }
    input[type="text"]:focus, input[type="tel"]:focus, select:focus, textarea:focus{
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--focus);
    }
    textarea{min-height:100px; resize:vertical; line-height:1.5;}

    .row{display:grid; gap:14px}
    @media(min-width:740px){ .row.cols2{grid-template-columns:1fr 1fr} }
    .mini{font-size:12px; color:var(--muted); margin-top:8px; line-height:1.4;}

    #comboBox{display:none}
    #comboFields{display:grid; gap:12px}
    @media(min-width:740px){ #comboFields{grid-template-columns:1fr 1fr} }

    .warn{
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(217,75,75,.35);
      background:rgba(217,75,75,.12);
      color:#7a1f1f;
      font-size:14px;
      line-height:1.4;
      margin-top:8px;
    }

    .orderSummary{
      margin-top:16px;
      padding:14px;
      background: rgba(215,180,106,.10);
      border-radius: 16px;
      border: 1px solid var(--gold1);
      font-size: 14px;
      display:none;
    }
    .orderSummary h4{
      margin: 0 0 8px 0;
      font-size: 15px;
      color: var(--accent);
    }
    .orderSummary ul{
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
    }
    .orderSummary .total{
      font-weight: 900;
      color: var(--text);
      margin-top: 10px;
      font-size: 16px;
    }

    footer{
      padding:26px 0 40px;
      color:var(--muted);
      font-size:13px;
      text-align:center;
      border-top:1px solid var(--stroke);
      margin-top:24px;
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <img src="logo.jpg" alt="DonJu Gourmet" width="76" height="76">
      </div>
      <div class="brandText">
        <h1>DonJu Gourmet</h1>
        <small>Un gusto que enamora ¬∑ Cierre 18:00 ¬∑ Entrega al d√≠a siguiente ¬∑ 180 ml</small>
      </div>
    </div>

    <div class="actions">
      <button class="btn whatsapp" id="waBtn" type="button" aria-label="Abrir WhatsApp">
        <svg class="waIcon" viewBox="0 0 32 32" aria-hidden="true">
          <path fill="currentColor" d="M19.11 17.53c-.27-.14-1.6-.79-1.85-.88-.25-.09-.43-.14-.62.14-.18.27-.71.88-.87 1.06-.16.18-.32.2-.59.07-.27-.14-1.15-.42-2.19-1.34-.81-.72-1.36-1.6-1.52-1.87-.16-.27-.02-.42.12-.56.12-.12.27-.32.41-.48.14-.16.18-.27.27-.45.09-.18.05-.34-.02-.48-.07-.14-.62-1.49-.85-2.04-.22-.53-.45-.46-.62-.47h-.53c-.18 0-.48.07-.73.34-.25.27-.96.94-.96 2.29 0 1.35.98 2.65 1.12 2.83.14.18 1.93 2.95 4.68 4.14.65.28 1.16.45 1.56.58.66.21 1.26.18 1.73.11.53-.08 1.6-.65 1.83-1.28.23-.62.23-1.16.16-1.28-.07-.12-.25-.2-.52-.34z"/>
          <path fill="currentColor" d="M26.7 5.3A13.34 13.34 0 0 0 16.02 1C8.7 1 2.76 6.94 2.76 14.26c0 2.33.61 4.6 1.77 6.6L2.65 31l10.34-1.81a13.2 13.2 0 0 0 3.03.35h.01c7.32 0 13.26-5.94 13.26-13.26 0-3.54-1.38-6.87-3.59-9.0zM16.03 27.3h-.01c-1.02 0-2.02-.15-2.97-.43l-.68-.2-6.13 1.07 1.09-5.97-.24-.73a11 11 0 0 1-1.07-4.79c0-6.07 4.94-11.01 11.01-11.01 2.94 0 5.7 1.15 7.77 3.22a10.9 10.9 0 0 1 3.23 7.78c0 6.07-4.94 11.01-11.01 11.01z"/>
        </svg>
        WhatsApp
      </button>

      <a class="btn ghost" id="igBtn" href="https://www.instagram.com/donju_gourmet/" target="_blank" rel="noopener noreferrer">Instagram</a>
      <a class="btn primary" href="#pedido">Pedir</a>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <h2>Postres artesanales listos para regalar (o darse un gusto)</h2>
      <p>
        Hechos por encargo para asegurar frescura.
        <strong>Cierre 18:00</strong> ¬∑ <strong>Entrega al d√≠a siguiente</strong>.
        Pagas por <strong>transferencia</strong> o <strong>efectivo</strong>. Delivery <strong>a coordinar</strong>.
      </p>
      <div class="heroRow">
        <span class="pill">üìç La Florida ¬∑ Macul ¬∑ Pe√±alol√©n ¬∑ Puente Alto ¬∑ La Granja</span>
        <span class="pill">üßÅ Porci√≥n: 180 ml</span>
        <span class="pill">üéÅ Combos: 3 y 5</span>
      </div>

      <div class="heroCarousel" aria-label="Galer√≠a de productos">
        <button class="hcBtn" id="hcPrevBtn" type="button" aria-label="Anterior">‚Äπ</button>
        <div class="hcFrame">
          <img id="hcImg" src="tiramisu.jpg" alt="Tiramis√∫" loading="eager">
          <div class="hcCaption" id="hcCaption">Tiramis√∫</div>
        </div>
        <button class="hcBtn" id="hcNextBtn" type="button" aria-label="Siguiente">‚Ä∫</button>
      </div>
    </section>

    <div class="grid cols2">
      <section class="card" id="menu">
        <h3>Men√∫</h3>
        <p class="muted">Elige cantidades. Si compras combo, podr√°s elegir sabores abajo.</p>
        <div class="menuList" id="menuList"></div>

        <hr class="hr">

        <div id="comboBox">
          <h3>Sabores del combo</h3>
          <p class="muted" style="margin-top:-6px;">Puedes repetir sabores. Si lo dejas en blanco, lo coordinamos por WhatsApp.</p>
          <div id="comboFields"></div>
        </div>

        <div class="orderSummary" id="orderSummary">
          <h4>üìã Tu pedido</h4>
          <ul id="summaryItems"></ul>
          <div class="total">Total: <span id="summaryTotal">$0</span></div>
        </div>
      </section>

      <section class="card" id="pedido">
        <h3>Datos del pedido</h3>
        <p class="muted">Se abrir√° WhatsApp con el pedido armado.</p>

        <div class="row cols2">
          <div>
            <label>Nombre</label>
            <input id="nombre" type="text" placeholder="Ej: Camila" autocomplete="name" />
          </div>
          <div>
            <label>Tel√©fono (opcional)</label>
            <input id="telefono" type="tel" placeholder="Ej: +56 9 1234 5678" autocomplete="tel" />
          </div>
        </div>

        <div class="row cols2">
          <div>
            <label>Comuna</label>
            <select id="comuna">
              <option>La Florida</option>
              <option>Macul</option>
              <option>Pe√±alol√©n</option>
              <option>Puente Alto</option>
              <option>La Granja</option>
            </select>
          </div>
          <div>
            <label>M√©todo de entrega</label>
            <select id="entrega">
              <option>Delivery (a coordinar)</option>
              <option>Retiro (a coordinar)</option>
            </select>
            <div class="mini" id="entregaHint"></div>
          </div>
        </div>

        <div class="row cols2">
          <div>
            <label>D√≠a de entrega</label>
            <input id="dia" type="text" placeholder="Ej: Ma√±ana / 24-02" />
          </div>
          <div>
            <label>Horario estimado</label>
            <input id="horario" type="text" placeholder="Ej: 18:30" />
          </div>
        </div>

        <div id="addressBlock">
          <label>Direcci√≥n (si es delivery)</label>
          <input id="direccion" type="text" placeholder="Calle + n√∫mero + depto/casa" autocomplete="street-address" />
        </div>

        <label>Notas</label>
        <textarea id="notas" placeholder="Alergias / dedicatoria / detalles del combo"></textarea>

        <div class="row cols2" style="align-items:end">
          <div>
            <label>M√©todo de pago</label>
            <select id="pago">
              <option>Transferencia</option>
              <option>Efectivo</option>
            </select>
            <div class="warn" id="warnBox" style="display:none"></div>
          </div>
          <div style="display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap">
            <button class="btn ghost" id="btnClear" type="button">Limpiar</button>
            <button class="btn primary" id="btnSend" type="button">Enviar por WhatsApp</button>
          </div>
        </div>
      </section>
    </div>

    <footer>
      ¬© <span id="year"></span> DonJu Gourmet ¬∑ Instagram: <span>@donju_gourmet</span> ¬∑ WhatsApp: +56 9 5605 9401
    </footer>
  </main>

  <script>
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function money(n){ return `$${Number(n||0).toLocaleString("es-CL")}`; }

    document.getElementById("year").textContent = new Date().getFullYear();

    const WHATSAPP_NUMBER = "56956059401";

    // Bot√≥n WhatsApp directo (chat sin pedido)
    document.getElementById("waBtn").addEventListener("click", () => {
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent("Hola DonJu Gourmet üëã Quiero hacer una consulta.")}`, "_blank");
    });

    // Instagram: app + fallback web
    (function fixInstagramLink(){
      const igBtn = document.getElementById("igBtn");
      if(!igBtn) return;
      const webUrl = "https://www.instagram.com/donju_gourmet/";
      const appUrl = "instagram://user?username=donju_gourmet";
      igBtn.addEventListener("click", (e) => {
        e.preventDefault();
        window.location.href = appUrl;
        setTimeout(() => window.open(webUrl, "_blank"), 800);
      });
    })();

    const PRODUCTS = [
      { id:"p1", name:"Tiramis√∫", desc:"Cremoso, con caf√© y cacao.", price:2000, type:"single", img:"tiramisu.jpg" },
      { id:"p2", name:"Cheesecake de maracuy√°", desc:"Dulce y √°cido balanceado.", price:2000, type:"single", img:"cheesecake-maracuya.jpg" },
      { id:"p3", name:"Suspiro Lime√±o", desc:"Manjar + merengue delicado.", price:2000, type:"single", img:"suspiro-limeno.jpg" },
      { id:"p4", name:"Mousse de manjar", desc:"Textura ligera y sedosa.", price:2000, type:"single", img:"mousse-manjar.jpg" },
      { id:"p5", name:"Carlota de mango", desc:"Cremoso y refrescante.", price:2000, type:"single", img:"carlota-mango.jpg" },
      { id:"c3", name:"Combo 3 (a elecci√≥n)", desc:"3 x 180 ml.", price:5500, type:"combo", picks:3, img:"combo3.jpg" },
      { id:"c5", name:"Combo 5 (a elecci√≥n)", desc:"5 x 180 ml.", price:9000, type:"combo", picks:5, img:"combo5.jpg" }
    ];
    const SINGLES = PRODUCTS.filter(p => p.type === "single");
    const COMBOS = PRODUCTS.filter(p => p.type === "combo");

    // Render men√∫
    const menuList = document.getElementById("menuList");
    PRODUCTS.forEach(p=>{
      const row = document.createElement("div");
      row.className = "item";
      row.innerHTML = `
        <div class="thumb"><img src="${escapeHtml(p.img)}" alt="${escapeHtml(p.name)}" loading="lazy"></div>
        <div>
          <div class="itemTitle">
            <strong>${escapeHtml(p.name)}</strong>
            <span class="priceTag">${money(p.price)}</span>
          </div>
          <div class="desc">${escapeHtml(p.desc)}</div>
        </div>
        <div class="qty">
          <input id="${p.id}" type="number" min="0" value="0" inputmode="numeric" aria-label="Cantidad ${escapeHtml(p.name)}">
        </div>
      `;
      menuList.appendChild(row);
    });

    // Combos
    const comboBox = document.getElementById("comboBox");
    const comboFields = document.getElementById("comboFields");

    function getQty(id){
      return parseInt(document.getElementById(id).value || "0", 10) || 0;
    }

    function updateComboUI(){
      let totalPicks = 0;
      COMBOS.forEach(c => totalPicks += getQty(c.id) * c.picks);

      if(totalPicks <= 0){
        comboBox.style.display = "none";
        comboFields.innerHTML = "";
        return;
      }

      comboBox.style.display = "block";
      const prev = Array.from(comboFields.querySelectorAll("select")).map(s => s.value || "");
      comboFields.innerHTML = "";

      for(let i=0;i<totalPicks;i++){
        const wrap = document.createElement("div");
        wrap.innerHTML = `
          <label>Selecci√≥n ${i+1}</label>
          <select id="pick_${i}">
            <option value="">(Elegir sabor)</option>
            ${SINGLES.map(s => `<option value="${escapeHtml(s.name)}">${escapeHtml(s.name)}</option>`).join("")}
          </select>
        `;
        comboFields.appendChild(wrap);
      }

      const sels = comboFields.querySelectorAll("select");
      sels.forEach((s, i) => { if(prev[i]) s.value = prev[i]; });
      sels.forEach(s => s.addEventListener("change", updateSummary));
    }

    // Entrega UI
    const entregaEl = document.getElementById("entrega");
    const addressBlock = document.getElementById("addressBlock");
    const entregaHint = document.getElementById("entregaHint");
    function updateEntrega(){
      const isDelivery = entregaEl.value.toLowerCase().includes("delivery");
      addressBlock.style.display = isDelivery ? "block" : "none";
      entregaHint.textContent = isDelivery ? "Agrega direcci√≥n para coordinar." : "Coordinamos retiro por WhatsApp.";
    }
    entregaEl.addEventListener("change", () => { updateEntrega(); updateSummary(); });
    updateEntrega();

    // Resumen en vivo + subtotales
    const orderSummary = document.getElementById("orderSummary");
    const summaryItems = document.getElementById("summaryItems");
    const summaryTotal = document.getElementById("summaryTotal");

    function buildOrder(){
      const lines = [];
      let total = 0;
      PRODUCTS.forEach(p=>{
        const q = getQty(p.id);
        if(q>0){
          const sub = q * p.price;
          total += sub;
          lines.push({ name: p.name, qty: q, sub });
        }
      });
      return { lines, total };
    }

    function updateSummary(){
      const { lines, total } = buildOrder();

      if(!lines.length){
        orderSummary.style.display = "none";
        summaryItems.innerHTML = "";
        summaryTotal.textContent = "$0";
        return;
      }

      orderSummary.style.display = "block";
      summaryItems.innerHTML = lines
        .map(l => `<li>${escapeHtml(l.name)} x${l.qty} ‚Äî <strong>${escapeHtml(money(l.sub))}</strong></li>`)
        .join("");

      summaryTotal.textContent = money(total);

      const comboUsed = (getQty("c3")>0 || getQty("c5")>0);
      if(comboUsed){
        const picks = Array.from(comboFields.querySelectorAll("select")).map(s=>s.value).filter(Boolean);
        if(picks.length){
          const count = {};
          picks.forEach(x=>count[x]=(count[x]||0)+1);
          const txt = Object.entries(count).map(([n,k])=>`${k}x ${n}`).join(" ¬∑ ");
          summaryItems.insertAdjacentHTML("beforeend", `<li><em>Sabores combo:</em> ${escapeHtml(txt)}</li>`);
        }else{
          summaryItems.insertAdjacentHTML("beforeend", `<li><em>Sabores combo:</em> a coordinar</li>`);
        }
      }
    }

    PRODUCTS.forEach(p=>{
      document.getElementById(p.id).addEventListener("input", () => {
        updateComboUI();
        updateSummary();
      });
    });

    // WhatsApp pedido
    const warnBox = document.getElementById("warnBox");

    function comboSummary(){
      if(comboBox.style.display === "none") return "";
      const picks = Array.from(comboFields.querySelectorAll("select")).map(s=>s.value).filter(Boolean);
      if(!picks.length) return "Sabores combo: (sin seleccionar, a coordinar)";
      const c = {};
      picks.forEach(x=>c[x]=(c[x]||0)+1);
      return "Sabores combo: " + Object.entries(c).map(([n,k])=>`${k} x ${n}`).join(" ¬∑ ");
    }

    document.getElementById("btnClear").addEventListener("click", ()=>{
      PRODUCTS.forEach(p=>document.getElementById(p.id).value = 0);
      comboFields.innerHTML = "";
      comboBox.style.display = "none";
      ["nombre","telefono","dia","horario","direccion","notas"].forEach(id=>document.getElementById(id).value="");
      warnBox.style.display="none";
      updateEntrega();
      updateSummary();
    });

    document.getElementById("btnSend").addEventListener("click", ()=>{
      warnBox.style.display="none";
      warnBox.textContent="";

      const { lines, total } = buildOrder();
      if(!lines.length){
        warnBox.style.display="block";
        warnBox.textContent="Te falta elegir al menos 1 √≠tem.";
        return;
      }

      const nombre = document.getElementById("nombre").value.trim() || "(sin nombre)";
      const telefono = document.getElementById("telefono").value.trim();
      const comuna = document.getElementById("comuna").value;
      const entrega = document.getElementById("entrega").value;
      const dia = document.getElementById("dia").value.trim() || "(sin fecha)";
      const horario = document.getElementById("horario").value.trim() || "(sin horario)";
      const direccion = document.getElementById("direccion").value.trim();
      const notas = document.getElementById("notas").value.trim();
      const pago = document.getElementById("pago").value;

      const isDelivery = entrega.toLowerCase().includes("delivery");
      if(isDelivery && !direccion){
        warnBox.style.display="block";
        warnBox.textContent="Si es delivery, agrega direcci√≥n.";
        return;
      }

      const linesText = lines.map(l => `- ${l.name} x${l.qty} = ${money(l.sub)}`).join("\n");

      const comboUsed = (getQty("c3")>0 || getQty("c5")>0);
      const comboText = comboUsed ? `\nüéÅ ${comboSummary()}\n` : "";

      const msg =
`Hola DonJu Gourmet üëã
Soy: ${nombre}${telefono ? ` (Tel: ${telefono})` : ""}

üßÅ Pedido (180 ml):
${linesText}
Total: ${money(total)}
${comboText}
üìç Comuna: ${comuna}
üöö Entrega: ${entrega} (a coordinar)
üìÖ D√≠a: ${dia}
üïí Hora: ${horario}
${isDelivery ? `üè† Direcci√≥n: ${direccion}\n` : ""}üí≥ Pago: ${pago}
${notas ? `üìù Notas: ${notas}\n` : ""}

(Cierre 18:00 ¬∑ Entrega al d√≠a siguiente ‚úÖ)`;

      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`, "_blank");
    });

    // Carrusel
    const HERO_SLIDES = [
      { src: "tiramisu.jpg", label: "Tiramis√∫" },
      { src: "cheesecake-maracuya.jpg", label: "Cheesecake de maracuy√°" },
      { src: "suspiro-limeno.jpg", label: "Suspiro Lime√±o" },
      { src: "mousse-manjar.jpg", label: "Mousse de manjar" },
      { src: "carlota-mango.jpg", label: "Carlota de mango" },
      { src: "combo3.jpg", label: "Combo 3" },
      { src: "combo5.jpg", label: "Combo 5" }
    ];
    let hcIndex = 0;
    let hcTimer = null;

    function hcRender(){
      const img = document.getElementById("hcImg");
      const cap = document.getElementById("hcCaption");
      if(!img || !cap) return;
      img.src = HERO_SLIDES[hcIndex].src;
      img.alt = HERO_SLIDES[hcIndex].label;
      cap.textContent = HERO_SLIDES[hcIndex].label;
    }
    function hcPrev(){
      hcIndex = (hcIndex - 1 + HERO_SLIDES.length) % HERO_SLIDES.length;
      hcRender(); hcStart();
    }
    function hcNext(){
      hcIndex = (hcIndex + 1) % HERO_SLIDES.length;
      hcRender(); hcStart();
    }
    function hcStart(){
      if(hcTimer) clearInterval(hcTimer);
      hcTimer = setInterval(hcNext, 3500);
    }

    document.getElementById("hcPrevBtn").addEventListener("click", hcPrev);
    document.getElementById("hcNextBtn").addEventListener("click", hcNext);

    hcRender(); hcStart();

    // init
    updateComboUI();
    updateSummary();
  </script>
</body>
</html>
